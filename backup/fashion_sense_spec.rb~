require 'spec_helper'

describe FashionSense do

  def valid_attributes
    {'nome' => 'nome_teste', 'email' => 'email_teste@abril.com.br', 'ddd' => 11, 'telefone' => 1234567, 'blog' => 'http://www.blog.com.br', 'audiencia' => 'google'}
  end

  before(:each) do
    FashionSense.delete_all
  end

  it "should fetch new email data" do
	FashionSense.new_emails(Time.now).count.should == 0
	FashionSense.new(valid_attributes).save
	FashionSense.new_emails(Time.now).count.should == 1
  end

  it "should not duplicate emails" do
	FashionSense.new(valid_attributes).save
	FashionSense.count.should == 1
	FashionSense.new(valid_attributes).save
	FashionSense.count.should == 1
	FashionSense.new({'nome' => 'nome_teste', 'email' => 'email_teste2', 'ddd' => 11, 'telefone' => 1234567, 'blog' => 'http://www.blog.com.br', 'audiencia' => 'google'}).save
	FashionSense.count.should == 2
  end

  it "should create csv with one line" do
	blogger = FashionSense.new(valid_attributes)
	blogger.save
	FashionSense.csv(Time.now).length.should == 1
	blog = FashionSense.new(valid_attributes)
	blog.email = "new_email@teste.com.br"
	blog.save
	FashionSense.csv(Time.now).length.should == 2
  end
end
